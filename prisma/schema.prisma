// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:dev.sqlite"
}

// Connexions boutique (données essentielles)
model ShopConnection {
  id          String   @id @default(cuid())
  shopId      String   @unique // gid://shopify/Shop/123456
  shopDomain  String   // example.myshopify.com
  shopUrl     String   // https://example.myshopify.com
  accessToken String   // Token Shopify (chiffré)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  lastSyncAt  DateTime?

  // Relations
  syncLogs SyncLog[]
  productSyncs ProductSync[]

  @@map("shop_connections")
}

// Logs de synchronisation
model SyncLog {
  id           String   @id @default(cuid())
  shopId       String
  syncType     String   // "import" | "export"
  productsCount Int
  status       String   // "success" | "error" | "partial"
  errorMessage String?
  createdAt    DateTime @default(now())

  // Relations
  shop ShopConnection @relation(fields: [shopId], references: [shopId], onDelete: Cascade)

  @@map("sync_logs")
}

// Données de produits synchronisés
model ProductSync {
  id                String   @id @default(cuid())
  shopId            String
  shopifyProductId  String   // gid://shopify/Product/123
  saasProductId     String?  // ID dans ton SaaS
  syncDirection     String   // "shopify_to_saas" | "saas_to_shopify"
  lastSyncAt        DateTime @default(now())

  // Relations
  shop ShopConnection @relation(fields: [shopId], references: [shopId], onDelete: Cascade)

  @@unique([shopId, shopifyProductId])
  @@map("product_syncs")
} 